<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Your Trip</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Top Bar -->
        <header class="topbar">
            <h1>Track Your Trip</h1>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Trip Details Section -->
            <section class="trip-details">
                <h2>Current Trip Details</h2>
                <table class="trip-table">
                    <thead>
                        <tr>
                            <th>Destination</th>
                            <th>Start From</th>
                            <th>Mode of Transport</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Number of People</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trip-table-body">
                        <tr>
                            <td colspan="7">No data available</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <!-- Trip Form Section -->
            <section class="trip-form">
                <h2>Create / Update Trip</h2>
                <form id="tripForm" onsubmit="event.preventDefault(); saveTrip();">
                    <input type="hidden" id="tripId">
                    <input type="text" id="destination" placeholder="Destination" required>
                    <input type="text" id="startFrom" placeholder="Start From" required>
                    <input type="text" id="modeOfTransport" placeholder="Mode of Transport" required>
                    <input type="date" id="startDate" required>
                    <input type="date" id="endDate" required>
                    <input type="number" id="numberOfPeople" placeholder="Number of People" required>
                    <button type="submit">Save Trip</button>
                </form>
            </section>
        </main>
    </div>

    <script>
        const apiUrl = 'http://localhost:8080/api/plan-trip'; // Replace with your actual backend URL

        // Fetch trips from the backend
        async function fetchTrips() {
            const response = await fetch(apiUrl);
            const trips = await response.json();

            const tableBody = document.getElementById('trip-table-body');
            tableBody.innerHTML = ''; // Clear table body

            trips.forEach(trip => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${trip.destination}</td>
                    <td>${trip.startFrom}</td>
                    <td>${trip.modeOfTransport}</td>
                    <td>${trip.startDate}</td>
                    <td>${trip.endDate}</td>
                    <td>${trip.numberOfPeople}</td>
                    <td>
                        <button onclick="editTrip(${trip.id})">Edit</button>
                        <button onclick="deleteTrip(${trip.id})">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Create or update a trip
        async function saveTrip() {
            const trip = {
                destination: document.getElementById('destination').value,
                startFrom: document.getElementById('startFrom').value,
                modeOfTransport: document.getElementById('modeOfTransport').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                numberOfPeople: document.getElementById('numberOfPeople').value,
            };

            const id = document.getElementById('tripId').value;

            if (id) {
                // Update existing trip
                await fetch(`${apiUrl}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(trip),
                });
            } else {
                // Create new trip
                await fetch(`${apiUrl}/newT`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(trip),
                });
            }

            clearForm();
            fetchTrips(); // Refresh the table
        }

        // Delete a trip
        async function deleteTrip(id) {
            if (confirm('Are you sure you want to delete this trip?')) {
                await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
                fetchTrips(); // Refresh the table
            }
        }

        // Load trip details into the form for editing
        async function editTrip(id) {
            const response = await fetch(`${apiUrl}/${id}`);
            const trip = await response.json();

            document.getElementById('tripId').value = trip.id;
            document.getElementById('destination').value = trip.destination;
            document.getElementById('startFrom').value = trip.startFrom;
            document.getElementById('modeOfTransport').value = trip.modeOfTransport;
            document.getElementById('startDate').value = trip.startDate;
            document.getElementById('endDate').value = trip.endDate;
            document.getElementById('numberOfPeople').value = trip.numberOfPeople;
        }

        // Clear the form
        function clearForm() {
            document.getElementById('tripForm').reset();
            document.getElementById('tripId').value = '';
        }

        // Initial fetch on page load
        document.addEventListener('DOMContentLoaded', fetchTrips);
    </script>
</body>
</html>
